<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Covariate Extraction</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="site_libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">LGCP on Metric Graphs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="graph_setup.html">Graph</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Covariates
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="covariates.html">Extracting Covariates</a>
    </li>
    <li>
      <a href="covariates2.html">Computing Spatial Covariates</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    LGCP
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="model_fitting1.html">Model 1</a>
    </li>
    <li>
      <a href="model_fitting2.html">Model 2</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Risk
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="exceedance.html">Exceedance Probabilities</a>
    </li>
  </ul>
</li>
<li>
  <a href="maps.html">Interactive Maps</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://arxiv.org/abs/2501.18558">
    <span class="fa fa-file-pdf"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/d-saduakhas/GraphLGCP">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Covariate Extraction</h1>

</div>


<p>In this section, we will show how to extract the spatial covariates
from the OpenStreetMap data. We will compute the distances to the
nearest objects and apply transformations to them. We will use the
Euclidean distance to the nearest mosque, school, bank, fuel station,
and hospital. We will then apply different transformations to these
distances, such as the inverse, inverse square root, logarithm, and
exponential decay.</p>
<div id="extracting-the-spatial-covariates" class="section level1"
number="1">
<h1><span class="header-section-number">1</span> Extracting the Spatial
Covariates</h1>
<p>We will now create `additional_city_objects.RDataâ€™ file that contains
the spatial covariates. We will extract the following spatial
covariates: mosques, education places, hospital places, finance places,
and intersections.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(osmdata)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(MetricGraph)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(rSPDE)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(INLA)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(qs)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># Define the CRS using the WKT string</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>crs_wkt <span class="ot">&lt;-</span> <span class="st">&#39;GEOGCRS[&quot;unknown&quot;,</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="st">    DATUM[&quot;World Geodetic System 1984&quot;,</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="st">        ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="st">            LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="st">        ID[&quot;EPSG&quot;,6326]],</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="st">    PRIMEM[&quot;Greenwich&quot;,0,</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="st">        ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="st">        ID[&quot;EPSG&quot;,8901]],</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="st">    CS[ellipsoidal,2],</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="st">        AXIS[&quot;longitude&quot;,east,</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a><span class="st">            ORDER[1],</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="st">            ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a><span class="st">                ID[&quot;EPSG&quot;,9122]]],</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a><span class="st">        AXIS[&quot;latitude&quot;,north,</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="st">            ORDER[2],</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a><span class="st">            ANGLEUNIT[&quot;degree&quot;,0.0174532925199433,</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a><span class="st">                ID[&quot;EPSG&quot;,9122]]]]&#39;</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="co"># Create the CRS object</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>new_crs <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(crs_wkt)</span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="co"># Read the polygon data and set the new CRS</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>polygon <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="fu">here</span>(<span class="st">&quot;Data/center_ahsa_polygon.geojson&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">&quot;POLYGON&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(new_crs)</span></code></pre></div>
<pre><code>## Reading layer `center_ahsa_polygon&#39; from data source 
##   `/Users/saduakd/Documents/MetricGraphLGCP/Data/center_ahsa_polygon.geojson&#39; 
##   using driver `GeoJSON&#39;
## Simple feature collection with 1 feature and 1 field
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 49.43056 ymin: 25.26735 xmax: 49.79261 ymax: 25.57398
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(polygon)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co"># Visualize the polygon boundary</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="fu">addProviderTiles</span>(<span class="st">&quot;CartoDB.Positron&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">addPolygons</span>(<span class="at">data =</span> polygon, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">fill =</span> <span class="cn">FALSE</span>, <span class="at">weight =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-e4409849e39179307f2e" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-e4409849e39179307f2e">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",null,null,{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[49.43056317178412,49.44080423210259,49.44743080054396,49.47212982837085,49.54381725060015,49.65044476097482,49.78598820636634,49.79140994418201,49.79261477480771,49.79080752886915,49.79080752886915,49.75586744072378,49.69984281662862,49.63176988627643,49.57454043155556,49.51791339214755,49.48719021119214,49.44020181678974,49.43056317178412],"lat":[25.42217110791317,25.49084645357821,25.53301552547779,25.56193146049465,25.56916044424887,25.57397976675168,25.50530442108663,25.49265369951676,25.39144792695775,25.3155435975385,25.28060350939313,25.27337452563891,25.2673503725104,25.2673503725104,25.26795278782325,25.27096486438751,25.30951944440999,25.37458029819792,25.42217110791317]}]]],null,null,{"interactive":true,"className":"","stroke":true,"color":"red","weight":2,"opacity":0.5,"fill":false,"fillColor":"red","fillOpacity":0.2,"smoothFactor":1,"noClip":false},null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[25.2673503725104,25.57397976675168],"lng":[49.43056317178412,49.79261477480771]}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Load graph</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">qread</span>(<span class="fu">here</span>(<span class="st">&quot;Data/graph_mesh_pruned_100m_7FRC_ver2.qs&quot;</span>))</span></code></pre></div>
<div id="highways-and-intersections" class="section level2"
number="1.1">
<h2><span class="header-section-number">1.1</span> Highways and
Intersections</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="do">####### EXPLORING available OSM Data #######</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>data_width <span class="ot">=</span> <span class="fu">opq</span>(<span class="at">bb =</span> bb) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">&quot;width&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>() </span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="do">## HIGHWAY</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>tags_highway <span class="ot">&lt;-</span> <span class="fu">available_tags</span>(<span class="st">&quot;highway&quot;</span>)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>data_highway <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bb =</span> bb) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">&quot;highway&quot;</span>, <span class="at">value =</span> tags_highway<span class="sc">$</span>Value) <span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>points_highway <span class="ot">&lt;-</span> data_highway<span class="sc">$</span>osm_points <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(highway)) <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="fu">select</span>(geometry, highway)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="fu">table</span>(points_highway<span class="sc">$</span>highway)</span></code></pre></div>
<pre><code>## 
##          bus_stop          crossing motorway_junction      speed_camera 
##                 1               162                10                10 
##       street_lamp   traffic_signals    turning_circle      turning_loop 
##                 4                47                 7                 1</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> points_highway, <span class="fu">aes</span>(<span class="at">color =</span> highway)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># discard street_lamp</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>points_highway <span class="ot">&lt;-</span> points_highway <span class="sc">%&gt;%</span> <span class="fu">filter</span>(highway <span class="sc">!=</span> <span class="st">&quot;street_lamp&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>lines_highway <span class="ot">&lt;-</span> data_highway<span class="sc">$</span>osm_lines <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(highway)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="fu">select</span>(geometry, highway)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="fu">table</span>(lines_highway<span class="sc">$</span>highway)</span></code></pre></div>
<pre><code>## 
##   construction         escape        footway  living_street       motorway 
##             76              2            305            134              2 
##  motorway_link           path     pedestrian        primary   primary_link 
##              9             18             34            162             62 
##       proposed    residential      secondary secondary_link        service 
##              2          13688            537             72           3976 
##          steps       tertiary  tertiary_link          track          trunk 
##              4            623             64            114            115 
##     trunk_link   unclassified 
##             93           1645</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>polygon_highway <span class="ot">&lt;-</span> data_highway<span class="sc">$</span>osm_polygons <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(highway)) <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="fu">select</span>(geometry, highway)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="fu">table</span>(polygon_highway<span class="sc">$</span>highway)</span></code></pre></div>
<pre><code>## 
##      footway         path   pedestrian      primary  residential    secondary 
##            8            1            5           23          156           64 
##      service     tertiary        track        trunk unclassified 
##           77           31            1            5           39</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> polygon_highway, <span class="fu">aes</span>(<span class="at">color =</span> highway)) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-3-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="leisure-amenities-and-buildings" class="section level2"
number="1.2">
<h2><span class="header-section-number">1.2</span> Leisure, Amenities,
and Buildings</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="do">## LEISURE</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>tags_leisure <span class="ot">&lt;-</span> <span class="fu">available_tags</span>(<span class="st">&quot;leisure&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>data_leisure <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bb =</span> bb) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">&quot;leisure&quot;</span>, <span class="at">value =</span> tags_leisure<span class="sc">$</span>Value) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>points_leisure <span class="ot">&lt;-</span> data_leisure<span class="sc">$</span>osm_points <span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(leisure)) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="fu">select</span>(geometry, leisure)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="fu">table</span>(points_leisure<span class="sc">$</span>leisure)</span></code></pre></div>
<pre><code>## 
## fitness_centre           park   picnic_table          pitch     playground 
##              1              2              3              3             34 
##        stadium 
##              1</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>polygon_leisure <span class="ot">&lt;-</span> data_leisure<span class="sc">$</span>osm_polygons <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(leisure)) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">select</span>(geometry, leisure)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="fu">table</span>(polygon_leisure<span class="sc">$</span>leisure)</span></code></pre></div>
<pre><code>## 
## fitness_centre         garden           park          pitch     playground 
##              1              4             94            102              3 
##  sports_centre        stadium  swimming_pool          track 
##             13              5              2              2</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="do">## AMENITY</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>tags_amenity <span class="ot">&lt;-</span> <span class="fu">available_tags</span>(<span class="st">&quot;amenity&quot;</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>data_amenity <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bb =</span> bb) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">&quot;amenity&quot;</span>, <span class="at">value =</span> tags_amenity<span class="sc">$</span>Value) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>points_amenity <span class="ot">&lt;-</span> data_amenity<span class="sc">$</span>osm_points <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(amenity)) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="fu">select</span>(geometry, amenity)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="fu">table</span>(points_amenity<span class="sc">$</span>amenity)[<span class="fu">order</span>(<span class="fu">table</span>(points_amenity<span class="sc">$</span>amenity), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
<pre><code>## 
## place_of_worship             bank       restaurant             fuel 
##               81               61               50               36 
##           school              atm            bench             cafe 
##               28               17               17               12 
##         hospital        fast_food          toilets         pharmacy 
##               11                9                7                6 
##          library           clinic          shelter         car_wash 
##                5                4                4                3 
##          college   drinking_water         fountain          parking 
##                3                3                3                3 
##           police community_centre      marketplace parking_entrance 
##                3                2                2                2 
##      post_office      bus_station       car_rental charging_station 
##                2                1                1                1 
##          dentist          doctors     fire_station        ice_cream 
##                1                1                1                1 
##     kindergarten           prison     waste_basket 
##                1                1                1</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="do">## BUILDING</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>tags_building <span class="ot">&lt;-</span> <span class="fu">available_tags</span>(<span class="st">&quot;building&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>data_building <span class="ot">&lt;-</span> <span class="fu">opq</span>(<span class="at">bb =</span> bb) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="fu">add_osm_feature</span>(<span class="at">key =</span> <span class="st">&quot;building&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="fu">osmdata_sf</span>()</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>points_building <span class="ot">&lt;-</span> data_building<span class="sc">$</span>osm_points <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(building)) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  <span class="fu">select</span>(geometry, building)</span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="fu">table</span>(points_building<span class="sc">$</span>building)[<span class="fu">order</span>(<span class="fu">table</span>(points_building<span class="sc">$</span>building), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
<pre><code>## 
##     mosque     bunker        yes industrial     school 
##          5          3          2          1          1</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>polygon_building <span class="ot">&lt;-</span> data_building<span class="sc">$</span>osm_polygons <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(building)) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  <span class="fu">select</span>(geometry, building)</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="fu">table</span>(polygon_building<span class="sc">$</span>building)[<span class="fu">order</span>(<span class="fu">table</span>(polygon_building<span class="sc">$</span>building), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span></code></pre></div>
<pre><code>## 
##           yes         house       college          barn     dormitory 
##          3865           183            37            25            16 
##        school     warehouse          roof        mosque    university 
##            16            15            11            10             9 
##        retail    apartments      hospital    commercial       stadium 
##             6             5             4             3             3 
##       parking  construction     religious       service sports_centre 
##             2             1             1             1             1 
## train_station 
##             1</code></pre>
</div>
<div id="main-functions" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Main Functions</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="do">######### EXTRACTING Specific Amenities #########</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>remove_duplicates_within_threshold <span class="ot">&lt;-</span> <span class="cf">function</span>(data, threshold) {</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>    <span class="co"># Convert the distance threshold to meters</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>    distance_threshold <span class="ot">&lt;-</span> units<span class="sc">::</span><span class="fu">set_units</span>(threshold, <span class="st">&quot;meters&quot;</span>)</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>    <span class="co"># Identify pairs of points that are within the distance threshold</span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a>    within_distance <span class="ot">&lt;-</span> <span class="fu">st_is_within_distance</span>(data, data, <span class="at">dist =</span> distance_threshold)</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a>    keep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="fu">length</span>(within_distance))</span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a>    <span class="co"># Loop through each point and mark duplicates for removal</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(within_distance)) {</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a>      <span class="cf">if</span> (keep[i]) {</span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a>        duplicates <span class="ot">&lt;-</span> within_distance[[i]]</span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>        <span class="co"># Mark all duplicates (excluding the current point) for removal</span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">length</span>(duplicates) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a>          keep[duplicates[<span class="sc">-</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a>        }</span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a>      }</span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a>    }</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a>    unique_data <span class="ot">&lt;-</span> data[keep, ]</span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a>    <span class="fu">return</span>(unique_data)</span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a>  }</span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a><span class="co"># Fetch OSM data for both points and polygons</span></span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a>fetch_osm_data <span class="ot">&lt;-</span> <span class="cf">function</span>(key, value, bb) {</span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a>  <span class="co"># Fetch points data and check if it exists</span></span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a>  data_points <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a>    <span class="fu">opq</span>(<span class="at">bb =</span> bb) <span class="sc">%&gt;%</span></span>
<span id="cb23-30"><a href="#cb23-30" tabindex="-1"></a>      <span class="fu">add_osm_feature</span>(<span class="at">key =</span> key, <span class="at">value =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb23-31"><a href="#cb23-31" tabindex="-1"></a>      <span class="fu">osmdata_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-32"><a href="#cb23-32" tabindex="-1"></a>      .<span class="sc">$</span>osm_points <span class="sc">%&gt;%</span></span>
<span id="cb23-33"><a href="#cb23-33" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(key))) <span class="sc">%&gt;%</span></span>
<span id="cb23-34"><a href="#cb23-34" tabindex="-1"></a>      <span class="fu">select</span>(geometry, <span class="sc">!!</span><span class="fu">sym</span>(key))</span>
<span id="cb23-35"><a href="#cb23-35" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-36"><a href="#cb23-36" tabindex="-1"></a>    <span class="cn">NULL</span>  <span class="co"># Return NULL if points data is not available</span></span>
<span id="cb23-37"><a href="#cb23-37" tabindex="-1"></a>  })</span>
<span id="cb23-38"><a href="#cb23-38" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" tabindex="-1"></a>  <span class="co"># Fetch polygons data and check if it exists</span></span>
<span id="cb23-40"><a href="#cb23-40" tabindex="-1"></a>  data_polygons <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb23-41"><a href="#cb23-41" tabindex="-1"></a>    <span class="fu">opq</span>(<span class="at">bb =</span> bb) <span class="sc">%&gt;%</span></span>
<span id="cb23-42"><a href="#cb23-42" tabindex="-1"></a>      <span class="fu">add_osm_feature</span>(<span class="at">key =</span> key, <span class="at">value =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb23-43"><a href="#cb23-43" tabindex="-1"></a>      <span class="fu">osmdata_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-44"><a href="#cb23-44" tabindex="-1"></a>      .<span class="sc">$</span>osm_polygons <span class="sc">%&gt;%</span></span>
<span id="cb23-45"><a href="#cb23-45" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(key))) <span class="sc">%&gt;%</span></span>
<span id="cb23-46"><a href="#cb23-46" tabindex="-1"></a>      <span class="fu">select</span>(geometry, <span class="sc">!!</span><span class="fu">sym</span>(key))</span>
<span id="cb23-47"><a href="#cb23-47" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb23-48"><a href="#cb23-48" tabindex="-1"></a>    <span class="cn">NULL</span>  <span class="co"># Return NULL if polygons data is not available</span></span>
<span id="cb23-49"><a href="#cb23-49" tabindex="-1"></a>  })</span>
<span id="cb23-50"><a href="#cb23-50" tabindex="-1"></a></span>
<span id="cb23-51"><a href="#cb23-51" tabindex="-1"></a>  <span class="co"># Check if both points and polygons data are available</span></span>
<span id="cb23-52"><a href="#cb23-52" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(data_points) <span class="sc">&amp;&amp;</span> <span class="fu">is.null</span>(data_polygons)) {</span>
<span id="cb23-53"><a href="#cb23-53" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)  <span class="co"># Skip if no data available</span></span>
<span id="cb23-54"><a href="#cb23-54" tabindex="-1"></a>  }</span>
<span id="cb23-55"><a href="#cb23-55" tabindex="-1"></a></span>
<span id="cb23-56"><a href="#cb23-56" tabindex="-1"></a>  <span class="co"># Convert polygons to points (centroids) if polygons are available</span></span>
<span id="cb23-57"><a href="#cb23-57" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(data_polygons) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(data_polygons) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb23-58"><a href="#cb23-58" tabindex="-1"></a>    centroids_polygons <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(data_polygons) <span class="sc">%&gt;%</span></span>
<span id="cb23-59"><a href="#cb23-59" tabindex="-1"></a>      <span class="fu">select</span>(geometry, <span class="sc">!!</span><span class="fu">sym</span>(key))</span>
<span id="cb23-60"><a href="#cb23-60" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-61"><a href="#cb23-61" tabindex="-1"></a>    centroids_polygons <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb23-62"><a href="#cb23-62" tabindex="-1"></a>  }</span>
<span id="cb23-63"><a href="#cb23-63" tabindex="-1"></a></span>
<span id="cb23-64"><a href="#cb23-64" tabindex="-1"></a>  <span class="co"># Combine points and centroids if both are available</span></span>
<span id="cb23-65"><a href="#cb23-65" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(data_points) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(data_points) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(centroids_polygons)) {</span>
<span id="cb23-66"><a href="#cb23-66" tabindex="-1"></a>    combined <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_points, centroids_polygons)</span>
<span id="cb23-67"><a href="#cb23-67" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(data_points) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(data_points) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb23-68"><a href="#cb23-68" tabindex="-1"></a>    combined <span class="ot">&lt;-</span> data_points</span>
<span id="cb23-69"><a href="#cb23-69" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-70"><a href="#cb23-70" tabindex="-1"></a>    combined <span class="ot">&lt;-</span> centroids_polygons</span>
<span id="cb23-71"><a href="#cb23-71" tabindex="-1"></a>  }</span>
<span id="cb23-72"><a href="#cb23-72" tabindex="-1"></a></span>
<span id="cb23-73"><a href="#cb23-73" tabindex="-1"></a>  <span class="co"># Check that only the value of interest is present</span></span>
<span id="cb23-74"><a href="#cb23-74" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> combined <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!!</span><span class="fu">sym</span>(key) <span class="sc">==</span> value)</span>
<span id="cb23-75"><a href="#cb23-75" tabindex="-1"></a></span>
<span id="cb23-76"><a href="#cb23-76" tabindex="-1"></a>  unique_combined <span class="ot">=</span> <span class="fu">remove_duplicates_within_threshold</span>(combined, <span class="dv">100</span>)</span>
<span id="cb23-77"><a href="#cb23-77" tabindex="-1"></a></span>
<span id="cb23-78"><a href="#cb23-78" tabindex="-1"></a>  <span class="fu">return</span>(unique_combined)</span>
<span id="cb23-79"><a href="#cb23-79" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="extracting-the-amenities" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Extracting the
Amenities</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># MOSQUES  </span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>mosques <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;place_of_worship&quot;</span>, bb)</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>mosques2 <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;building&quot;</span>, <span class="st">&quot;mosque&quot;</span>, bb)</span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a>mosques2 <span class="ot">=</span> mosques2 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">amenity =</span> building)</span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a>mosques <span class="ot">=</span> <span class="fu">rbind</span>(mosques, mosques2)</span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a>mosques<span class="sc">$</span>amenity <span class="ot">=</span> <span class="st">&quot;mosque&quot;</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a>mosques <span class="ot">=</span> <span class="fu">remove_duplicates_within_threshold</span>(mosques, <span class="dv">200</span>)</span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The number of unique mosques is&quot;</span>, <span class="fu">nrow</span>(mosques), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## The number of unique mosques is 108</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> mosques, <span class="fu">aes</span>(<span class="at">color =</span> amenity)) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># EDUCATION</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>college <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;college&quot;</span>, bb)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>college2 <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;building&quot;</span>, <span class="st">&quot;college&quot;</span>, bb)</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>school <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;school&quot;</span>, bb)</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>school2 <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;building&quot;</span>, <span class="st">&quot;school&quot;</span>, bb)</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>kindergarten <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;kindergarten&quot;</span>, bb)</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>library <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;library&quot;</span>, bb)</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>university <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;university&quot;</span>, bb)</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>university2 <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;building&quot;</span>, <span class="st">&quot;university&quot;</span>, bb)</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="co"># Merge all the education data and check the number of unique points</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>education <span class="ot">=</span> <span class="fu">rbind</span>(college, school, kindergarten, library, university)</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>education2 <span class="ot">=</span> <span class="fu">rbind</span>(college2, school2, university2)<span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">amenity =</span> building)</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>education <span class="ot">=</span> <span class="fu">rbind</span>(education, education2)</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>education<span class="sc">$</span>amenity <span class="ot">=</span> <span class="st">&quot;education&quot;</span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a>education_places <span class="ot">=</span> <span class="fu">remove_duplicates_within_threshold</span>(education, <span class="dv">200</span>)</span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The number of unique education points is&quot;</span>, <span class="fu">nrow</span>(education_places), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## The number of unique education points is 73</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> education_places, <span class="fu">aes</span>(<span class="at">color =</span> amenity)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-6-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="co"># HEALTH</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>hospital <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;hospital&quot;</span>, bb)</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>hospital2 <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;building&quot;</span>, <span class="st">&quot;hospital&quot;</span>, bb)</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>clinic <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;clinic&quot;</span>, bb)</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>dentist <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;dentist&quot;</span>, bb)</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>doctors <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;doctors&quot;</span>, bb)</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>pharmacy <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;pharmacy&quot;</span>, bb)</span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>hospitals <span class="ot">=</span> <span class="fu">rbind</span>(hospital, clinic, dentist, doctors, pharmacy)</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>hospitals2 <span class="ot">=</span> hospital2 <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">amenity =</span> building)</span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>hospitals<span class="ot">=</span> <span class="fu">rbind</span>(hospitals, hospitals2)</span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>hospitals<span class="sc">$</span>amenity <span class="ot">=</span> <span class="st">&quot;hospital&quot;</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>hospital_places <span class="ot">=</span> <span class="fu">remove_duplicates_within_threshold</span>(hospitals, <span class="dv">200</span>)</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The number of unique hospital points is&quot;</span>, <span class="fu">nrow</span>(hospitals), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## The number of unique hospital points is 39</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> hospital_places, <span class="fu">aes</span>(<span class="at">color =</span> amenity)) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-6-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># FINANCE</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>bank <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;bank&quot;</span>, bb)</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>atm <span class="ot">=</span> <span class="fu">fetch_osm_data</span>(<span class="st">&quot;amenity&quot;</span>, <span class="st">&quot;atm&quot;</span>, bb)</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>finance <span class="ot">=</span> <span class="fu">rbind</span>(bank, atm)</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>finance<span class="sc">$</span>amenity <span class="ot">=</span> <span class="st">&quot;finance&quot;</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>finance_places <span class="ot">=</span> <span class="fu">remove_duplicates_within_threshold</span>(finance, <span class="dv">200</span>)</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The number of unique finance points is&quot;</span>, <span class="fu">nrow</span>(finance_places), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## The number of unique finance points is 65</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> finance_places, <span class="fu">aes</span>(<span class="at">color =</span> amenity)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-6-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># JUNCTIONS</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>intersection <span class="ot">=</span> <span class="fu">remove_duplicates_within_threshold</span>(points_highway, <span class="dv">300</span>)</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a><span class="co"># rename the column </span></span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>intersection <span class="ot">=</span> intersection <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">amenity =</span> highway)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>intersection<span class="sc">$</span>amenity <span class="ot">=</span> <span class="st">&quot;intersection&quot;</span></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> intersection, <span class="fu">aes</span>(<span class="at">color =</span> amenity)) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-6-5.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="do">## Save all amenities data</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="fu">save</span>(mosques, education_places, hospital_places, finance_places, intersection, <span class="at">file =</span> <span class="st">&quot;Data/additional_city_objects.RData&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># Plot all amenities</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>graph<span class="sc">$</span><span class="fu">plot</span>(<span class="at">vertex_size =</span> <span class="dv">0</span>, <span class="at">edge_width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mosques, <span class="fu">aes</span>(<span class="at">color =</span> amenity), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> education_places, <span class="fu">aes</span>(<span class="at">color =</span> amenity), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> hospital_places, <span class="fu">aes</span>(<span class="at">color =</span> amenity), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> finance_places, <span class="fu">aes</span>(<span class="at">color =</span> amenity), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> intersection, <span class="fu">aes</span>(<span class="at">color =</span> amenity), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="covariates_files/figure-html/unnamed-chunk-7-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
